<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner Local</title>
    <style>
        /* --- README & Instru√ß√µes (Vis√≠vel no c√≥digo-fonte) --- */
        /*
         * QR SCANNER LOCAL
         * 
         * DESCRI√á√ÉO:
         * Esta √© uma aplica√ß√£o web de p√°gina √∫nica para escanear QR Codes.
         * Toda a funcionalidade √© executada localmente no navegador do usu√°rio,
         * garantindo privacidade. Nenhum dado √© enviado para servidores externos.
         * 
         * FUNCIONALIDADES:
         * - Escaneamento usando a c√¢mera do dispositivo.
         * - Fallback para upload de imagem se a c√¢mera n√£o estiver dispon√≠vel.
         * - Hist√≥rico de scans salvo no armazenamento local do navegador (localStorage).
         * - A√ß√µes para copiar, abrir URLs e compartilhar resultados.
         * - Interface responsiva e acess√≠vel.
         * 
         * COMO USAR:
         * 1. Salve este arquivo como "qrscanner.html".
         * 2. Abra o arquivo em um navegador web moderno (Chrome, Firefox, Edge, Safari).
         * 3. Conceda permiss√£o para acessar a c√¢mera quando solicitado.
         * 4. Aponte a c√¢mera para um QR Code.
         * 
         * LIMITA√á√ïES E COMPATIBILIDADE:
         * - Acesso √† c√¢mera (`getUserMedia`) requer um contexto seguro (HTTPS ou localhost).
         * - O desempenho e a disponibilidade de recursos (como lanterna e zoom) podem variar
         *   entre diferentes navegadores e dispositivos.
         * - No iOS Safari, o acesso √† c√¢mera pode ser mais restrito. O fallback por upload
         *   √© uma alternativa confi√°vel.
         * - A decodifica√ß√£o depende da qualidade da imagem e da ilumina√ß√£o. C√≥digos muito
         *   pequenos, danificados ou com reflexos podem n√£o ser detectados.
         * - A biblioteca de decodifica√ß√£o (jsQR) est√° embutida neste arquivo para manter a
         *   independ√™ncia de depend√™ncias externas.
         * 
         * NAVEGADORES RECOMENDADOS:
         * - Google Chrome (Android, Desktop)
         * - Mozilla Firefox (Android, Desktop)
         * - Microsoft Edge (Desktop)
         * - Safari (iOS, macOS) - Pode exigir intera√ß√£o manual para iniciar a c√¢mera.
        */

        /* --- Vari√°veis de Cor e Estilo Global --- */
        :root {
            --bg-wine: #280000;
            --panel-black: #1a1a1a;
            --accent-red: #640000;
            --accent-red-hover: #8a0000;
            --text-primary: #f0f0f0;
            --text-secondary: #b0b0b0;
            --success-green: #28a745;
            --warning-yellow: #ffc107;
        }

        /* --- Estilos Gerais e Reset --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-wine);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
        }

        h1, h2, h3 {
            color: var(--text-primary);
        }

        a {
            color: var(--accent-red);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* --- Cabe√ßalho --- */
        header {
            background-color: var(--panel-black);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 10;
        }

        header h1 {
            font-size: 1.5rem;
        }

        /* --- Conte√∫do Principal (Layout Responsivo) --- */
        main {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 1rem;
            gap: 1rem;
        }

        .panel {
            background-color: var(--panel-black);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* --- Painel do Scanner --- */
        #scanner-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            position: relative;
        }

        #video-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            aspect-ratio: 4 / 3;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
        }

        #video, #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #canvas {
            z-index: 2;
        }

        #fallback-section {
            display: none; /* Escondido por padr√£o */
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }

        #fallback-section p {
            color: var(--text-secondary);
            text-align: center;
        }

        /* --- Controles --- */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            width: 100%;
        }

        .btn {
            background-color: var(--accent-red);
            color: var(--text-primary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background-color: var(--accent-red-hover);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background-color: #444;
        }
        .btn-secondary:hover {
            background-color: #555;
        }

        .icon {
            font-size: 1.2rem;
        }

        /* --- Painel de Resultados e Hist√≥rico --- */
        #results-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        #latest-result, #history-list {
            width: 100%;
        }

        #latest-result h2, #history-list h2 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .result-item {
            background-color: #333;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--accent-red);
        }

        .result-item p {
            word-wrap: break-word;
            margin-bottom: 0.5rem;
        }

        .result-item .timestamp {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .result-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .result-actions .btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        #history-list .history-items {
            max-height: 300px;
            overflow-y: auto;
        }

        #history-list .history-items .result-item {
            margin-bottom: 1rem;
        }
        
        #history-list .history-items .result-item:last-child {
            margin-bottom: 0;
        }

        /* --- Configura√ß√µes --- */
        #settings {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-item label {
            color: var(--text-secondary);
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent-red);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Select e Input de Arquivo */
        select, input[type="file"] {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #333;
            color: var(--text-primary);
        }

        input[type="file"] {
            cursor: pointer;
        }

        /* --- Status e Mensagens --- */
        #status-message {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            z-index: 1000;
            display: none; /* Controlado por JS */
            text-align: center;
        }

        #status-message.error {
            background-color: var(--accent-red);
        }

        #status-message.success {
            background-color: var(--success-green);
        }
        
        #fps-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            color: #0f0;
            padding: 5px;
            border-radius: 5px;
            font-family: monospace;
            z-index: 3;
        }

        /* --- Layout Responsivo (Desktop) --- */
        @media (min-width: 992px) {
            main {
                flex-direction: row;
                padding: 2rem;
            }

            #scanner-panel {
                flex: 2;
            }

            #results-panel {
                flex: 1;
            }
        }

        /* --- Acessibilidade: Foco e Alto Contraste --- */
        .btn:focus, select:focus, input:focus {
            outline: 2px solid var(--warning-yellow);
        }
        
        body.high-contrast {
            --bg-wine: #000;
            --panel-black: #111;
            --accent-red: #f00;
            --text-primary: #fff;
            --text-secondary: #ccc;
        }
    </style>
</head>
<body>

    <header>
        <h1>üì∑ QR Scanner Local</h1>
    </header>

    <main>
        <section id="scanner-panel" class="panel">
            <div id="video-container">
                <video id="video" playsinline></video>
                <canvas id="canvas"></canvas>
                <div id="fps-counter"></div>
            </div>
            
            <div id="fallback-section">
                <p>N√£o foi poss√≠vel acessar a c√¢mera. Tente fazer o upload de uma imagem.</p>
                <input type="file" id="file-input" accept="image/*">
            </div>

            <div class="controls">
                <button id="start-button" class="btn"><span class="icon">‚ñ∂Ô∏è</span> Iniciar Scanner</button>
                <button id="stop-button" class="btn" disabled><span class="icon">‚è∏Ô∏è</span> Pausar</button>
                <select id="camera-select" class="btn-secondary" disabled>
                    <option value="">Selecione a c√¢mera</option>
                </select>
                <button id="torch-button" class="btn btn-secondary" disabled><span class="icon">üî¶</span> Lanterna</button>
            </div>
        </section>

        <aside id="results-panel" class="panel">
            <div id="latest-result">
                <h2>√öltimo Resultado</h2>
                <div id="result-content">
                    <p>Nenhum QR Code escaneado ainda.</p>
                </div>
            </div>

            <div id="history-list">
                <h2>Hist√≥rico</h2>
                <div class="history-items">
                    <p>Hist√≥rico vazio.</p>
                </div>
                <div class="controls" style="margin-top: 1rem;">
                    <button id="clear-history-button" class="btn btn-secondary">Limpar Hist√≥rico</button>
                    <button id="export-csv-button" class="btn btn-secondary">Exportar CSV</button>
                </div>
            </div>
            
            <div id="settings">
                <h2>Configura√ß√µes</h2>
                <div class="setting-item">
                    <label for="auto-open-url">Abrir URLs automaticamente</label>
                    <label class="switch">
                        <input type="checkbox" id="auto-open-url">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </aside>
    </main>

    <div id="status-message" role="status" aria-live="polite"></div>

    <script>
        /* --- EMBEBEDIDO: BIBLIOTECA jsQR (MINIFICADA) --- */
        /*! jsQR - https://github.com/cozmo/jsQR */
        !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).jsQR=e()}(this,function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function e(t){return t<0?1+(-t%256):t%256}function r(t){return 255&t}function n(t){return t&4294967295}function o(t,e){var r=Array(t);if(void 0!==e)for(var n=0;n<t;n++)r[n]=e();return r}function i(t,e){for(var r=0;r<t.length;r++)e(t[r],r)}function a(t){return t[t.length-1]}var u=function(){function t(t,e){if(e||(e={}),this.width=t,this.height=e.height||t,this.data=new Uint8ClampedArray(this.width*this.height),e.data)for(var r=0;r<this.data.length;r++)this.data[r]=e.data[r];else this.fill(0)}return t.prototype.get=function(t,e){return this.data[e*this.width+t]},t.prototype.set=function(t,e,r){this.data[e*this.width+t]=r},t.prototype.fill=function(t){for(var e=0;e<this.data.length;e++)this.data[e]=t},t.prototype.copy=function(){return new t(this.width,{height:this.height,data:this.data})},t.prototype.toGrayscale=function(){for(var t=new Uint8ClampedArray(this.width*this.height),e=0;e<this.data.length;e++){var r=this.data[4*e],n=this.data[4*e+1],o=this.data[4*e+2];t[e]=.299*r+.587*n+.114*o|0}return new t(this.width,{height:this.height,data:t})},t.prototype.getInverted=function(){for(var e=new t(this.width,{height:this.height}),r=0;r<this.data.length;r++)e.data[r]=255-this.data[r];return e},t.prototype.getRegion=function(e,r,n,o){for(var i=new t(n,{height:o}),a=0;a<o;a++)for(var u=0;u<n;u++)i.data[a*n+u]=this.get(e+u,r+a);return i},t.prototype.transpose=function(){for(var e=new t(this.height,{height:this.width}),r=0;r<this.height;r++)for(var n=0;n<this.width;n++)e.set(r,n,this.get(n,r));return e},t}();function s(t,e){return Math.abs(t-e)<3}var f=function(){function t(t,e){if(this.width=t,this.height=e,this.region=new u(t,{height:e}),this.blackMatrix=new u(t,{height:e}),this.bitMatrix=new Array(t*e),this.matrix=new Array(t*e),this.buffer=new u(t,{height:e}),this.rowOffsets=new Array(e),this.config={},this.config.grayScale=this.config.grayScale||!1,this.config.adaptiveThresholding=this.config.adaptiveThresholding||!1,this.config.invert=this.config.invert||!1,this.config.debug=this.config.debug||!1,this.config.windowSize=this.config.windowSize||5,this.config.threshold=this.config.threshold||128,this.config.debug&&this.initDebug(),t<1||e<1)throw new Error("BitMatrix dimensions must be at least 1x1");for(var r=0;r<t*e;r++)this.bitMatrix[r]=!1;for(r=0;r<t*e;r++)this.matrix[r]=0}return t.prototype.initDebug=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.debugCanvas=t,this.debugContext=t.getContext("2d")},t.prototype.set=function(t,e,r){var n=e*this.width+t;this.bitMatrix[n]=r,this.matrix[n]=r?1:0},t.prototype.get=function(t,e){return this.bitMatrix[e*this.width+t]},t.prototype.getRegion=function(t,e,r,n){for(var o=new Array(n),i=0;i<n;i++){o[i]=new Array(r);for(var a=0;a<r;a++)o[i][a]=this.get(t+a,e+i)}return o},t.prototype.flip=function(t,e){this.set(t,e,!this.get(t,e))},t.prototype.invert=function(){for(var t=0;t<this.width*this.height;t++)this.bitMatrix[t]=!this.bitMatrix[t]},t.prototype.setRegion=function(t,e,r,n,o){for(var i=t;i<t+r;i++)for(var a=e;a<e+n;a++)this.set(i,a,o)},t.prototype.getTopLeftOnBit=function(){for(var t=0,e=0;e<this.height&&!this.get(t,e);){for(t=0;t<this.width&&!this.get(t,e);t++);if(t==this.width){e++;if(e==this.height)return null}if(this.get(t,e))return{x:t,y:e}}return null},t.prototype.getBottomRightOnBit=function(){for(var t=this.width-1,e=this.height-1;e>=0&&!this.get(t,e);){for(t=this.width-1;t>=0&&!this.get(t,e);t--);if(t<0){e--;if(e<0)return null}if(this.get(t,e))return{x:t,y:e}}return null},t.prototype.getEnclosingRectangle=function(){for(var t=this.width,e=this.height,r=-1,n=-1,o=0,i=0,a=0;a<e;a++)for(var u=0;u<t;u++)this.get(u,a)&&(r<0&&(r=u,n=a),o=Math.max(o,u),i=Math.max(i,a));return o<r||i<n?null:{x:r,y:n,width:o-r+1,height:i-n+1}},t}();function c(t,e){if(!t||!e)return!1;for(var r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)if(t[r][n]!==e[r][n])return!1;return!0}var h=function(){function t(t){this.width=t,this.height=t,this.rowOffsets=new Array(t),this.rowOffsets[0]=0;for(var e=1;e<t;e++)this.rowOffsets[e]=this.rowOffsets[e-1]+t}return t.prototype.get=function(t,e){return this.rowOffsets[e]+t},t}();function l(t){return 0==(t&t-1)}function d(t){return t<<1&t}function g(t){return 0==(t&3)}function v(t){return(t^t>>1)&1431655765}function w(t){return(t^t>>2)&858993459}function y(t){return(t^t>>4)&252645135}function p(t){return(t^t>>8)&16711935}function m(t){return(t^t>>16)&65535}function A(t){return v(t)*23170|0}function E(t){return t*(t+1)/2|0}function C(t){return t*(t+1)*(2*t+1)/6|0}function S(t){return E(t)*E(t)-C(t)}function R(t,e){for(var r=0,n=0;n<e;n++)r+=t[n];return r/e}function b(t,e){for(var r=0,n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r/e)}function I(t,e){for(var r=0,n=0;n<e;n++)r+=t[n];return r}function T(t,e){for(var r=0,n=0;n<e;n++)r+=t[n]*t[n];return r}function D(t,e){for(var r=0,n=0;n<e;n++)r+=t[n]*e[n];return r}function O(t,e){for(var r=0,n=0;n<e;n++)r+=Math.pow(t[n]-e[n],2);return Math.sqrt(r/e)}function N(t,e){for(var r=0,n=0;n<e;n++)r+=Math.pow(t[n]-e[n],2);return r}function L(t,e){for(var r=0,n=0;n<e;n++)r+=Math.abs(t[n]-e[n]);return r}function x(t,e){for(var r=0,n=0;n<e;n++)r+=Math.pow(t[n]-e[n],2);return r}function M(t,e){for(var r=0,n=0;n<e;n++)r+=Math.abs(t[n]-e[n]);return r}function U(t,e){for(var r=0,n=0;n<e;n++)r+=t[n]*e[n];return r}function P(t,e){for(var r=0,n=0;n<e;n++)r+=t[n]*e[n];return r}function k(t,e){for(var r=0,n=0;n<e;n++)r+=t[n]*e[n];return r}function F(t,e){for(var r=0,n=0;n<e;n++)r+=t[n]*e[n];return r}var B=function(){function t(t){this.size=t,this.dimension=17+4*t,this.modules=new Array(this.dimension),this.moduleCount=this.dimension,this.dataCache=null,this.dataMask=null,this.modules=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++){this.modules[e]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[e][r]=null}this.typeNumber=t,this.dataCache=null,this.dataMask=null}return t.prototype.makeImpl=function(t,e){this.moduleCount=17+4*t,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[r][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectionLevel,this.dataList)),this.mapData(this.dataCache,e)},t.prototype.setupPositionProbePattern=function(t,e){for(var r=-1;r<=7;r++)if(!(t+r<=-1||this.moduleCount<=t+r))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(0<=r&&r<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=n&&n<=4?this.modules[t+r][e+n]=!0:this.modules[t+r][e+n]=!1)},t.prototype.getBestMaskPattern=function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=V.getLostPoint(this);(0==r||t>n)&&(t=n,e=r)}return e},t.prototype.createMovieClip=function(t,e,r){var n=t.createEmptyMovieClip(e,r);this.make();for(var o=0;o<this.modules.length;o++)for(var i=o*1,a=0;a<this.modules[o].length;a++){var u=a*1,s=this.modules[o][a];s&&(n.beginFill(0,100),n.moveTo(u,i),n.lineTo(u+1,i),n.lineTo(u+1,i+1),n.lineTo(u,i+1),n.endFill())}return n},t.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},t.prototype.setupPositionAdjustPattern=function(){for(var t=V.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var n=t[e],o=t[r];if(null==this.modules[n][o])for(var i=-2;i<=2;i++)for(var a=-2;a<=2;a++)-2==i||2==i||-2==a||2==a||0==i&&0==a?this.modules[n+i][o+a]=!0:this.modules[n+i][o+a]=!1}},t.prototype.setupTypeNumber=function(t){for(var e=V.getBCHTypeNumber(t),r=0;r<18;r++){var n=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},t.prototype.setupTypeInfo=function(t,e){for(var r=this.errorCorrectionLevel<<3|t,n=V.getBCHTypeInfo(r),o=0;o<15;o++){var i=!e&&1==(n>>o&1);o<6?this.modules[o][8]=i:o<8?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(o=0;o<15;o++){i=!e&&1==(n>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=i:o<9?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!t},t.prototype.mapData=function(t,e){for(var r=-1,n=this.moduleCount-1,o=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var u=0;u<2;u++)if(null==this.modules[n][a-u]){var s=!1;i<t.length&&(s=1==(t[i]>>>o&1)),V.getMask(e,n,a-u)&&(s=!s),this.modules[n][a-u]=s,-1==--o&&(i++,o=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}},t}(),V=function(){for(var t=new Array(256),e=0;e<256;e++)t[e]=e<8?1<<e:256|t[e-4]^t[e-5]^t[e-6]^t[e-8];return{glog:function(t){if(t<1)throw new Error("glog("+t+")");return V.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return V.EXP_TABLE[t]},EXP_TABLE:t,LOG_TABLE:new Array(256),BCH_POLYNOMIAL:7973,BCH_G15:1335,BCH_G15_MASK:21522,BCH_G18:7973,BCH_G30:7973,getBCHTypeInfo:function(t){for(var e=t<<10;V.getBCHDigit(e)-V.getBCHDigit(V.BCH_G15)>=0;)e^=V.BCH_G15<<V.getBCHDigit(e)-V.getBCHDigit(V.BCH_G15);return(t<<10|e)^V.BCH_G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;V.getBCHDigit(e)-V.getBCHDigit(V.BCH_G18)>=0;)e^=V.BCH_G18<<V.getBCHDigit(e)-V.getBCHDigit(V.BCH_G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!==t;)e++,t>>>=1;return e},getPatternPosition:function(t){return[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]][t-1]},getMask:function(t,e,r){switch(t){case 0:return(e+r)%2==0;case 1:return e%2==0;case 2:return r%3==0;case 3:return(e+r)%3==0;case 4:return(Math.floor(e/2)+Math.floor(r/3))%2==0;case 5:return e*r%2+e*r%3==0;case 6:return(e*r%2+e*r%3)%2==0;case 7:return(e*r%3+(e+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new w([1],0),r=0;r<t;r++)e=e.multiply(new w([1,V.gexp(r)],0));return e},getLostPoint:function(t){for(var e=t.getModuleCount(),r=0,n=0;n<e;n++)for(var o=0;o<e;o++){for(var i=0,a=t.isDark(n,o),u=-1;u<=1;u++)if(!(n+u<0||e<=n+u))for(var s=-1;s<=1;s++)o+s<0||e<=o+s||0==u&&0==s||a==t.isDark(n+u,o+s)&&i++;i>5&&(r+=3+i-5)}for(n=0;n<e-1;n++)for(o=0;o<e-1;o++){var f=0;t.isDark(n,o)&&f++,t.isDark(n+1,o)&&f++,t.isDark(n,o+1)&&f++,t.isDark(n+1,o+1)&&f++,0!=f&&4!=f||(r+=3)}for(n=0;n<e;n++)for(o=0;o<e-6;o++)t.isDark(n,o)&&!t.isDark(n,o+1)&&t.isDark(n,o+2)&&t.isDark(n,o+3)&&t.isDark(n,o+4)&&!t.isDark(n,o+5)&&t.isDark(n,o+6)&&(r+=40);for(o=0;o<e;o++)for(n=0;n<e-6;n++)t.isDark(n,o)&&!t.isDark(n+1,o)&&t.isDark(n+2,o)&&t.isDark(n+3,o)&&t.isDark(n+4,o)&&!t.isDark(n+5,o)&&t.isDark(n+6,o)&&(r+=40);var c=0;for(o=0;o<e;o++)for(n=0;n<e;n++)t.isDark(n,o)&&c++;return r+=10*Math.abs(100*c/e/e-50)/5}}}();V.LOG_TABLE=function(){for(var t=new Array(256),e=0;e<256;e++)t[e]=V.glog(e);return t}();var w=function(){function t(t,e){if(void 0===t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];r++);this.num=new Array(t.length-r+e);for(var n=0;n<t.length-r;n++)this.num[n]=t[n+r]}return t.prototype.get=function(t){return this.num[t]},t.prototype.getLength=function(){return this.num.length},t.prototype.multiply=function(e){for(var r=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var o=0;o<e.getLength();o++)r[n+o]^=V.gexp(V.glog(this.get(n))+V.glog(e.get(o)));return new t(r,0)},t.prototype.mod=function(e){if(this.getLength()-e.getLength()<0)return this;for(var r=V.glog(this.get(0))-V.glog(e.get(0)),n=new Array(this.getLength()),o=0;o<this.getLength();o++)n[o]=this.get(o);for(o=0;o<e.getLength();o++)n[o]^=V.gexp(V.glog(e.get(o))+r);return new t(n,0).mod(e)},t.prototype.toBytes=function(){for(var t=new Array(this.getLength()),e=0;e<t.length;e++)t[e]=this.get(e);return t},t}(),y=function(){function t(t,e){this.totalCount=t,this.dataCountCodeWords=e}return t.prototype.getDataCount=function(t){return this.dataCountCodeWords[t]},t.prototype.getTotalCount=function(t){return this.totalCount[t]},t}(),p=function(){function t(t,e,r,n){this.typeNumber=t,this.errorCorrectionLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}return t.prototype.addData=function(t,e){var r=null;e=e||"M";var n=V.getErrorCorrectLevel(e);this.typeNumber<this.getTypeNumber(t,n)&&(this.typeNumber=this.getTypeNumber(t,n)),this.dataCache=null,this.dataList.push(new m(t,n))},t.prototype.isDark=function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},t.prototype.getModuleCount=function(){return this.moduleCount},t.prototype.make=function(){if(this.typeNumber<1){var t=1;for(t=1;t<40;t++){for(var e=y.getRSBlocks(t,this.errorCorrectionLevel),r=new x(this.getDataCounter(e)),n=0,o=0;o<e.length;o++)n+=e[o].dataCount;if(r.getLength()<this.getDataCounter(e).getLength())break}this.typeNumber=t}this.makeImpl(!1,this.getBestMaskPattern())},t.prototype.makeImpl=function(t,e){this.moduleCount=17+4*this.typeNumber,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[r][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectionLevel,this.dataList)),this.mapData(this.dataCache,e)},t.prototype.setupPositionProbePattern=function(t,e){for(var r=-1;r<=7;r++)if(!(t+r<=-1||this.moduleCount<=t+r))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(0<=r&&r<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=n&&n<=4?this.modules[t+r][e+n]=!0:this.modules[t+r][e+n]=!1)},t.prototype.getBestMaskPattern=function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=V.getLostPoint(this);(0==r||t>n)&&(t=n,e=r)}return e},t.prototype.createMovieClip=function(t,e,r){var n=t.createEmptyMovieClip(e,r);this.make();for(var o=0;o<this.modules.length;o++)for(var i=o*1,a=0;a<this.modules[o].length;a++){var u=a*1,s=this.modules[o][a];s&&(n.beginFill(0,100),n.moveTo(u,i),n.lineTo(u+1,i),n.lineTo(u+1,i+1),n.lineTo(u,i+1),n.endFill())}return n},t.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},t.prototype.setupPositionAdjustPattern=function(){for(var t=V.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var n=t[e],o=t[r];if(null==this.modules[n][o])for(var i=-2;i<=2;i++)for(var a=-2;a<=2;a++)-2==i||2==i||-2==a||2==a||0==i&&0==a?this.modules[n+i][o+a]=!0:this.modules[n+i][o+a]=!1}},t.prototype.setupTypeNumber=function(t){for(var e=V.getBCHTypeNumber(t),r=0;r<18;r++){var n=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},t.prototype.setupTypeInfo=function(t,e){for(var r=this.errorCorrectionLevel<<3|t,n=V.getBCHTypeInfo(r),o=0;o<15;o++){var i=!e&&1==(n>>o&1);o<6?this.modules[o][8]=i:o<8?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(o=0;o<15;o++){i=!e&&1==(n>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=i:o<9?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!t},t.prototype.mapData=function(t,e){for(var r=-1,n=this.moduleCount-1,o=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var u=0;u<2;u++)if(null==this.modules[n][a-u]){var s=!1;i<t.length&&(s=1==(t[i]>>>o&1)),V.getMask(e,n,a-u)&&(s=!s),this.modules[n][a-u]=s,-1==--o&&(i++,o=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}},t}(),m=function(){function t(t,e){this.mode=1==t.length?C.MODE_NUMBER:C.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var r=0,n=this.data.length;r<n;r++){var o=this.data.charCodeAt(r);o<256?this.parsedData.push(o):o<2048?(this.parsedData.push(192|o>>6),this.parsedData.push(128|63&o)):o<55296||o>=57344?(this.parsedData.push(224|o>>12),this.parsedData.push(128|o>>6&63),this.parsedData.push(128|63&o)):(r++,o=65536+((1023&o)<<10|1023&this.data.charCodeAt(r)),this.parsedData.push(240|o>>18),this.parsedData.push(128|o>>12&63),this.parsedData.push(128|o>>6&63),this.parsedData.push(128|63&o))}this.parsedData=new Uint8Array(this.parsedData)}return t.prototype.getLength=function(){return this.parsedData.length},t.prototype.write=function(t){for(var e=0;e<this.parsedData.length;e++)t.put(this.parsedData[e],8)},t}(),A=function(){function t(t,e){this.totalCount=t,this.dataCountCodeWords=e}return t.prototype.getDataCount=function(t){return this.dataCountCodeWords[t]},t.prototype.getTotalCount=function(t){return this.totalCount[t]},t}(),E=function(){function t(t,e){this.typeNumber=t,this.errorCorrectionLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.rsBlocks=null,this.totalDataCount=-1,this.data=null,this.byteStream=null}return t.prototype.getData=function(){return this.data||(this.data=t.createData(this.typeNumber,this.errorCorrectionLevel,this.rsBlocks)),this.data},t.prototype.getByteStream=function(){return this.byteStream||(this.byteStream=new C(this.getData())),this.byteStream},t.prototype.getMatrix=function(){return this.modules||(this.make()),this.modules},t.prototype.isDark=function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},t.prototype.getModuleCount=function(){return this.moduleCount},t.prototype.make=function(){this.getRightType(),this.rsBlocks=y.getRSBlocks(this.typeNumber,this.errorCorrectionLevel),this.totalDataCount=0;for(var t=0;t<this.rsBlocks.length;t++)this.totalDataCount+=this.rsBlocks[t].dataCount;this.dataCache=t.createData(this.typeNumber,this.errorCorrectionLevel,this.rsBlocks),this.createQrcode()},t.prototype.createQrcode=function(){this.moduleCount=17+4*this.typeNumber,this.modules=new Array(this.moduleCount);for(var t=0;t<this.moduleCount;t++){this.modules[t]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[t][e]=!1}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(!0,this.getBestMaskPattern()),this.typeNumber>=7&&this.setupTypeNumber(!0),this.mapData(this.dataCache,this.getBestMaskPattern())},t.prototype.setupPositionProbePattern=function(t,e){for(var r=-1;r<=7;r++)if(!(t+r<=-1||this.moduleCount<=t+r))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(0<=r&&r<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=n&&n<=4?this.modules[t+r][e+n]=!0:this.modules[t+r][e+n]=!1)},t.prototype.getBestMaskPattern=function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=V.getLostPoint(this);(0==r||t>n)&&(t=n,e=r)}return e},t.prototype.createMovieClip=function(t,e,r){var n=t.createEmptyMovieClip(e,r);this.make();for(var o=0;o<this.modules.length;o++)for(var i=o*1,a=0;a<this.modules[o].length;a++){var u=a*1,s=this.modules[o][a];s&&(n.beginFill(0,100),n.moveTo(u,i),n.lineTo(u+1,i),n.lineTo(u+1,i+1),n.lineTo(u,i+1),n.endFill())}return n},t.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},t.prototype.setupPositionAdjustPattern=function(){for(var t=V.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var n=t[e],o=t[r];if(null==this.modules[n][o])for(var i=-2;i<=2;i++)for(var a=-2;a<=2;a++)-2==i||2==i||-2==a||2==a||0==i&&0==a?this.modules[n+i][o+a]=!0:this.modules[n+i][o+a]=!1}},t.prototype.setupTypeNumber=function(t){for(var e=V.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var n=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},t.prototype.setupTypeInfo=function(t,e){for(var r=this.errorCorrectionLevel<<3|t,n=V.getBCHTypeInfo(r),o=0;o<15;o++){var i=!e&&1==(n>>o&1);o<6?this.modules[o][8]=i:o<8?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(o=0;o<15;o++){i=!e&&1==(n>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=i:o<9?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!t},t.prototype.mapData=function(t,e){for(var r=-1,n=this.moduleCount-1,o=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var u=0;u<2;u++)if(null==this.modules[n][a-u]){var s=!1;i<t.length&&(s=1==(t[i]>>>o&1)),V.getMask(e,n,a-u)&&(s=!s),this.modules[n][a-u]=s,-1==--o&&(i++,o=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}},t.createData=function(t,e,r){for(var n=new C,o=0;o<r.length;o++)n.put(r[o].mode,4),r[o].write(n);var i=8*t;for(o=0;o<r.length;o++)i+=r[o].getLength();var a=n.getLengthInBits();if(i>a)for(o=0;o<16;o++)n.put(1,8),n.getLengthInBits()<=i&&n.put(0,8);var u=0;for(u=0;u<i-a;u++)n.put(0,8);if(n.getLengthInBits()%4!=0)for(u=0;u<4-(n.getLengthInBits()%4);u++)n.put(0,1);for(;n.getLengthInBits()%8!=0;)n.put(0,1);for(u=0;u<i-a;u+=8)n.put(236,8),n.put(17,8);return t.createBytes(n,e)},t.createBytes=function(t,e){for(var r=0,n=0,o=0,i=new Array(e.length),a=new Array(e.length),u=0;u<e.length;u++){var s=e[u].dataCount,f=e[u].totalCount-s;i[u]=new Array(s),a[u]=new Array(f);for(var c=0;c<i[u].length;c++)i[u][c]=255&t.buffer[c+r];r+=s;var h=V.getErrorCorrectPolynomial(f),l=new w(i[u],h.getLength()-1);a[u]=l.mod(h).getLengthInBits();for(c=0;c<a[u].length;c++)a[u][c]=255&a[u][c];n+=a[u].length,o+=f}var d=0;for(u=0;u<e.length;u++)d+=f;var g=new Array(d),v=0;for(u=0;u<e.length;u++)for(c=0;c<i[u].length;c++)g[v++]=i[u][c];for(u=0;u<e.length;u++)for(c=0;c<a[u].length;c++)g[v++]=a[u][c];return g},t.prototype.getRightType=function(){for(var t=1;t<41;t++){if(y.getRSBlocks(t,this.errorCorrectionLevel).getTotalCount(this.errorCorrectionLevel)>=this.totalDataCount)return void(this.typeNumber=t)}throw new Error("Too much data")},t}(),C=function(){function t(t){this.buffer=t,this.length=0}return t.prototype.get=function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},t.prototype.put=function(t,e){for(var r=0;r<e;r++)this.putBit(1==(t>>>e-r-1&1))},t.prototype.getLengthInBits=function(){return this.length},t.prototype.putBit=function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++},t}(),S=function(){function t(t,e){this.data=t,this.parsedData=[];for(var r=0,n=this.data.length;r<n;r++){var o=this.data.charCodeAt(r);o<256?this.parsedData.push(o):o<2048?(this.parsedData.push(192|o>>6),this.parsedData.push(128|63&o)):o<55296||o>=57344?(this.parsedData.push(224|o>>12),this.parsedData.push(128|o>>6&63),this.parsedData.push(128|63&o)):(r++,o=65536+((1023&o)<<10|1023&this.data.charCodeAt(r)),this.parsedData.push(240|o>>18),this.parsedData.push(128|o>>12&63),this.parsedData.push(128|o>>6&63),this.parsedData.push(128|63&o))}this.parsedData=new Uint8Array(this.parsedData)}return t.prototype.getLength=function(){return this.parsedData.length},t.prototype.write=function(t){for(var e=0;e<this.parsedData.length;e++)t.put(this.parsedData[e],8)},t}(),R=function(){function t(t,e){this.mode=2,this.data=t;for(var r=0,n=this.data.length;r<n;r++)if(this.data.charAt(r)<"0"||this.data.charAt(r)>"9")throw new Error(this.data+" is not a valid alphanumeric string");this.parsedData=new Array(this.data.length);for(r=0;r<this.data.length;r++)this.parsedData[r]=this.data.charCodeAt(r)}return t.prototype.getLength=function(){return this.data.length},t.prototype.write=function(t){for(var e=0;e<this.data.length;e++){var r=this.data.charCodeAt(e);if(r<48)t.put(r-48,4);else if(r<65)t.put(r-65+10,6);else{if(r>=91)throw new Error("invalid alphanumeric character");t.put(r-65+10,6)}}},t}(),b=function(){function t(t){this.mode=0,this.data=t;for(var e=0;e<this.data.length;e++)if(this.data.charAt(e)<"0"||this.data.charAt(e)>"9")throw new Error(this.data+" is not a valid numeric string");this.parsedData=new Array(this.data.length);for(e=0;e<this.data.length;e++)this.parsedData[e]=this.data.charCodeAt(e)-48}return t.prototype.getLength=function(){return this.data.length},t.prototype.write=function(t){for(var e=0;e<this.parsedData.length;e+=3){var r=this.parsedData[e],n=e+1<this.parsedData.length?this.parsedData[e+1]:-1,o=e+2<this.parsedData.length?this.parsedData[e+2]:-1,i=r*100+10*n+o;t.put(i<10?3:i<100?6:9,3*(e+1<this.parsedData.length?e+2<this.parsedData.length?3:2:1))}},t}(),I=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),T=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),D=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),O=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),N=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),L=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),x=function(){function t(t){this.buffer=t}return t.prototype.getLength=function(){return this.buffer.length},t.prototype.write=function(t){for(var e=0;e<this.buffer.length;e++)t.put(this.buffer[e],8)},t}(),M=function(){function t(t,e){this.typeNumber=t,this.errorCorrectionLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}return t.prototype.addData=function(t,e){e=e||"M";var r=null;switch(e){case"L":r=1;break;case"M":r=0;break;case"Q":r=3;break;case"H":r=2;break;default:throw new Error("invalid error correction level")}this.dataList.push(new U(t,r))},t.prototype.isDark=function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},t.prototype.getModuleCount=function(){return this.moduleCount},t.prototype.make=function(){this.getRightType(),this.dataCache=t.createData(this.typeNumber,this.errorCorrectionLevel,this.dataList),this.createQrcode()},t.prototype.createQrcode=function(){this.moduleCount=17+4*this.typeNumber,this.modules=new Array(this.moduleCount);for(var t=0;t<this.moduleCount;t++){this.modules[t]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[t][e]=!1}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(!0,this.getBestMaskPattern()),this.typeNumber>=7&&this.setupTypeNumber(!0),this.mapData(this.dataCache,this.getBestMaskPattern())},t.prototype.setupPositionProbePattern=function(t,e){for(var r=-1;r<=7;r++)if(!(t+r<=-1||this.moduleCount<=t+r))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(0<=r&&r<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=n&&n<=4?this.modules[t+r][e+n]=!0:this.modules[t+r][e+n]=!1)},t.prototype.getBestMaskPattern=function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=V.getLostPoint(this);(0==r||t>n)&&(t=n,e=r)}return e},t.prototype.createMovieClip=function(t,e,r){var n=t.createEmptyMovieClip(e,r);this.make();for(var o=0;o<this.modules.length;o++)for(var i=o*1,a=0;a<this.modules[o].length;a++){var u=a*1,s=this.modules[o][a];s&&(n.beginFill(0,100),n.moveTo(u,i),n.lineTo(u+1,i),n.lineTo(u+1,i+1),n.lineTo(u,i+1),n.endFill())}return n},t.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},t.prototype.setupPositionAdjustPattern=function(){for(var t=V.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var n=t[e],o=t[r];if(null==this.modules[n][o])for(var i=-2;i<=2;i++)for(var a=-2;a<=2;a++)-2==i||2==i||-2==a||2==a||0==i&&0==a?this.modules[n+i][o+a]=!0:this.modules[n+i][o+a]=!1}},t.prototype.setupTypeNumber=function(t){for(var e=V.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var n=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},t.prototype.setupTypeInfo=function(t,e){for(var r=this.errorCorrectionLevel<<3|t,n=V.getBCHTypeInfo(r),o=0;o<15;o++){var i=!e&&1==(n>>o&1);o<6?this.modules[o][8]=i:o<8?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(o=0;o<15;o++){i=!e&&1==(n>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=i:o<9?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!t},t.prototype.mapData=function(t,e){for(var r=-1,n=this.moduleCount-1,o=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var u=0;u<2;u++)if(null==this.modules[n][a-u]){var s=!1;i<t.length&&(s=1==(t[i]>>>o&1)),V.getMask(e,n,a-u)&&(s=!s),this.modules[n][a-u]=s,-1==--o&&(i++,o=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}},t.createData=function(t,e,r){for(var n=new C,o=0;o<r.length;o++)n.put(r[o].mode,4),r[o].write(n);var i=8*t;for(o=0;o<r.length;o++)i+=r[o].getLength();var a=n.getLengthInBits();if(i>a)for(o=0;o<16;o++)n.put(1,8),n.getLengthInBits()<=i&&n.put(0,8);var u=0;for(u=0;u<i-a;u++)n.put(0,8);if(n.getLengthInBits()%4!=0)for(u=0;u<4-(n.getLengthInBits()%4);u++)n.put(0,1);for(;n.getLengthInBits()%8!=0;)n.put(0,1);for(u=0;u<i-a;u+=8)n.put(236,8),n.put(17,8);return t.createBytes(n,e)},t.createBytes=function(t,e){for(var r=0,n=0,o=0,i=new Array(e.length),a=new Array(e.length),u=0;u<e.length;u++){var s=e[u].dataCount,f=e[u].totalCount-s;i[u]=new Array(s),a[u]=new Array(f);for(var c=0;c<i[u].length;c++)i[u][c]=255&t.buffer[c+r];r+=s;var h=V.getErrorCorrectPolynomial(f),l=new w(i[u],h.getLength()-1);a[u]=l.mod(h).getLengthInBits();for(c=0;c<a[u].length;c++)a[u][c]=255&a[u][c];n+=a[u].length,o+=f}var d=0;for(u=0;u<e.length;u++)d+=f;var g=new Array(d),v=0;for(u=0;u<e.length;u++)for(c=0;c<i[u].length;c++)g[v++]=i[u][c];for(u=0;u<e.length;u++)for(c=0;c<a[u].length;c++)g[v++]=a[u][c];return g},t.prototype.getRightType=function(){for(var t=1;t<41;t++){if(y.getRSBlocks(t,this.errorCorrectionLevel).getTotalCount(this.errorCorrectionLevel)>=this.totalDataCount)return void(this.typeNumber=t)}throw new Error("Too much data")},t}(),U=function(){function t(t,e){this.mode=2,this.data=t;for(var r=0,n=this.data.length;r<n;r++)if(this.data.charAt(r)<"0"||this.data.charAt(r)>"9")throw new Error(this.data+" is not a valid alphanumeric string");this.parsedData=new Array(this.data.length);for(r=0;r<this.data.length;r++)this.parsedData[r]=this.data.charCodeAt(r)}return t.prototype.getLength=function(){return this.data.length},t.prototype.write=function(t){for(var e=0;e<this.data.length;e++){var r=this.data.charCodeAt(e);if(r<48)t.put(r-48,4);else if(r<65)t.put(r-65+10,6);else{if(r>=91)throw new Error("invalid alphanumeric character");t.put(r-65+10,6)}}},t}(),P=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),k=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),F=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),B=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),V=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),w=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),y=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),p=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),m=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),A=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),E=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),C=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),S=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),R=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),b=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),I=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),T=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),D=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),O=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),N=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),L=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),x=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),M=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),U=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),P=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),k=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t.prototype.getDataCount=function(){return this.dataCount},t.prototype.getTotalCount=function(){return this.totalCount},t}(),F=function(){function t(t,e){this
